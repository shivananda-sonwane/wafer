import mysql.connector as connection
import pandas as pd
class db_connection:
    """
    This is a class of data base connection. Here we can create database for our training data
    and then we can send all the training data to the database here we use mysql and while prediction time
    we get data from the database and based on that we do the prediction and as well as we can delete database
    as per our need.

    created by Tanmay Chakraborty
    Date: 30 Jun 2022


    """

    def __init__(self,host,user,password):
        self.host=host
        self.user=user
        self.password=password
    def create_db_connection(self):
        """
        This is a method which helps to create database connection
        """
        try:
            #establishing connection with databse
            mydb = connection.connect(host=self.host,user=self.user, passwd=self.password,auth_plugin='mysql_native_password')
            return mydb
        except Exception as e:
            return f"Error has happened while creating connection error is {e} "
    def show_databases(self,db):
        query = "SHOW DATABASES"
        cursor = db.cursor() #create a cursor to execute queries
        cursor.execute(query)
        return cursor.fetchall()
    def create_database(self,db,database_name):
        if db.is_connected()==True:
            query = f"If not exists Create database {database_name};"
            cursor = db.cursor() #create a cursor to execute queries
            cursor.execute(query)
            return "DataBase Created!!"
        else:
            return "Connection has not been established correctly! "
    def create_table(self,db,database,table_name):
        query = f"CREATE TABLE {database}.{table_name} (Wafer_names varchar(200) PRIMARY KEY,Sensor_1 float, Sensor_2 float, Sensor_3 float, Sensor_4 float, Sensor_5 float, Sensor_6 float, Sensor_7 float, Sensor_8 float, Sensor_9 float, Sensor_10 float, Sensor_11 float, Sensor_12 float, Sensor_13 float, Sensor_14 float, Sensor_15 float, Sensor_16 float, Sensor_17 float, Sensor_18 float, Sensor_19 float, Sensor_20 float, Sensor_21 float, Sensor_22 float, Sensor_23 float, Sensor_24 float, Sensor_25 float, Sensor_26 float, Sensor_27 float, Sensor_28 float, Sensor_29 float, Sensor_30 float, Sensor_31 float, Sensor_32 float, Sensor_33 float, Sensor_34 float, Sensor_35 float, Sensor_36 float, Sensor_37 float, Sensor_38 float, Sensor_39 float, Sensor_40 float, Sensor_41 float, Sensor_42 float, Sensor_43 float, Sensor_44 float, Sensor_45 float, Sensor_46 float, Sensor_47 float, Sensor_48 float, Sensor_49 float, Sensor_50 float, Sensor_51 float, Sensor_52 float, Sensor_53 float, Sensor_54 float, Sensor_55 float, Sensor_56 float, Sensor_57 float, Sensor_58 float, Sensor_59 float, Sensor_60 float, Sensor_61 float, Sensor_62 float, Sensor_63 float, Sensor_64 float, Sensor_65 float, Sensor_66 float, Sensor_67 float, Sensor_68 float, Sensor_69 float, Sensor_70 float, Sensor_71 float, Sensor_72 float, Sensor_73 float, Sensor_74 float, Sensor_75 float, Sensor_76 float, Sensor_77 float, Sensor_78 float, Sensor_79 float, Sensor_80 float, Sensor_81 float, Sensor_82 float, Sensor_83 float, Sensor_84 float, Sensor_85 float, Sensor_86 float, Sensor_87 float, Sensor_88 float, Sensor_89 float, Sensor_90 float, Sensor_91 float, Sensor_92 float, Sensor_93 float, Sensor_94 float, Sensor_95 float, Sensor_96 float, Sensor_97 float, Sensor_98 float, Sensor_99 float, Sensor_100 float, Sensor_101 float, Sensor_102 float, Sensor_103 float, Sensor_104 float, Sensor_105 float, Sensor_106 float, Sensor_107 float, Sensor_108 float, Sensor_109 float, Sensor_110 float, Sensor_111 float, Sensor_112 float, Sensor_113 float, Sensor_114 float, Sensor_115 float, Sensor_116 float, Sensor_117 float, Sensor_118 float, Sensor_119 float, Sensor_120 float, Sensor_121 float, Sensor_122 float, Sensor_123 float, Sensor_124 float, Sensor_125 float, Sensor_126 float, Sensor_127 float, Sensor_128 float, Sensor_129 float, Sensor_130 float, Sensor_131 float, Sensor_132 float, Sensor_133 float, Sensor_134 float, Sensor_135 float, Sensor_136 float, Sensor_137 float, Sensor_138 float, Sensor_139 float, Sensor_140 float, Sensor_141 float, Sensor_142 float, Sensor_143 float, Sensor_144 float, Sensor_145 float, Sensor_146 float, Sensor_147 float, Sensor_148 float, Sensor_149 float, Sensor_150 float, Sensor_151 float, Sensor_152 float, Sensor_153 float, Sensor_154 float, Sensor_155 float, Sensor_156 float, Sensor_157 float, Sensor_158 float, Sensor_159 float, Sensor_160 float, Sensor_161 float, Sensor_162 float, Sensor_163 float, Sensor_164 float, Sensor_165 float, Sensor_166 float, Sensor_167 float, Sensor_168 float, Sensor_169 float, Sensor_170 float, Sensor_171 float, Sensor_172 float, Sensor_173 float, Sensor_174 float, Sensor_175 float, Sensor_176 float, Sensor_177 float, Sensor_178 float, Sensor_179 float, Sensor_180 float, Sensor_181 float, Sensor_182 float, Sensor_183 float, Sensor_184 float, Sensor_185 float, Sensor_186 float, Sensor_187 float, Sensor_188 float, Sensor_189 float, Sensor_190 float, Sensor_191 float, Sensor_192 float, Sensor_193 float, Sensor_194 float, Sensor_195 float, Sensor_196 float, Sensor_197 float, Sensor_198 float, Sensor_199 float, Sensor_200 float, Sensor_201 float, Sensor_202 float, Sensor_203 float, Sensor_204 float, Sensor_205 float, Sensor_206 float, Sensor_207 float, Sensor_208 float, Sensor_209 float, Sensor_210 float, Sensor_211 float, Sensor_212 float, Sensor_213 float, Sensor_214 float, Sensor_215 float, Sensor_216 float, Sensor_217 float, Sensor_218 float, Sensor_219 float, Sensor_220 float, Sensor_221 float, Sensor_222 float, Sensor_223 float, Sensor_224 float, Sensor_225 float, Sensor_226 float, Sensor_227 float, Sensor_228 float, Sensor_229 float, Sensor_230 float, Sensor_231 float, Sensor_232 float, Sensor_233 float, Sensor_234 float, Sensor_235 float, Sensor_236 float, Sensor_237 float, Sensor_238 float, Sensor_239 float, Sensor_240 float, Sensor_241 float, Sensor_242 float, Sensor_243 float, Sensor_244 float, Sensor_245 float, Sensor_246 float, Sensor_247 float, Sensor_248 float, Sensor_249 float, Sensor_250 float, Sensor_251 float, Sensor_252 float, Sensor_253 float, Sensor_254 float, Sensor_255 float, Sensor_256 float, Sensor_257 float, Sensor_258 float, Sensor_259 float, Sensor_260 float, Sensor_261 float, Sensor_262 float, Sensor_263 float, Sensor_264 float, Sensor_265 float, Sensor_266 float, Sensor_267 float, Sensor_268 float, Sensor_269 float, Sensor_270 float, Sensor_271 float, Sensor_272 float, Sensor_273 float, Sensor_274 float, Sensor_275 float, Sensor_276 float, Sensor_277 float, Sensor_278 float, Sensor_279 float, Sensor_280 float, Sensor_281 float, Sensor_282 float, Sensor_283 float, Sensor_284 float, Sensor_285 float, Sensor_286 float, Sensor_287 float, Sensor_288 float, Sensor_289 float, Sensor_290 float, Sensor_291 float, Sensor_292 float, Sensor_293 float, Sensor_294 float, Sensor_295 float, Sensor_296 float, Sensor_297 float, Sensor_298 float, Sensor_299 float, Sensor_300 float, Sensor_301 float, Sensor_302 float, Sensor_303 float, Sensor_304 float, Sensor_305 float, Sensor_306 float, Sensor_307 float, Sensor_308 float, Sensor_309 float, Sensor_310 float, Sensor_311 float, Sensor_312 float, Sensor_313 float, Sensor_314 float, Sensor_315 float, Sensor_316 float, Sensor_317 float, Sensor_318 float, Sensor_319 float, Sensor_320 float, Sensor_321 float, Sensor_322 float, Sensor_323 float, Sensor_324 float, Sensor_325 float, Sensor_326 float, Sensor_327 float, Sensor_328 float, Sensor_329 float, Sensor_330 float, Sensor_331 float, Sensor_332 float, Sensor_333 float, Sensor_334 float, Sensor_335 float, Sensor_336 float, Sensor_337 float, Sensor_338 float, Sensor_339 float, Sensor_340 float, Sensor_341 float, Sensor_342 float, Sensor_343 float, Sensor_344 float, Sensor_345 float, Sensor_346 float, Sensor_347 float, Sensor_348 float, Sensor_349 float, Sensor_350 float, Sensor_351 float, Sensor_352 float, Sensor_353 float, Sensor_354 float, Sensor_355 float, Sensor_356 float, Sensor_357 float, Sensor_358 float, Sensor_359 float, Sensor_360 float, Sensor_361 float, Sensor_362 float, Sensor_363 float, Sensor_364 float, Sensor_365 float, Sensor_366 float, Sensor_367 float, Sensor_368 float, Sensor_369 float, Sensor_370 float, Sensor_371 float, Sensor_372 float, Sensor_373 float, Sensor_374 float, Sensor_375 float, Sensor_376 float, Sensor_377 float, Sensor_378 float, Sensor_379 float, Sensor_380 float, Sensor_381 float, Sensor_382 float, Sensor_383 float, Sensor_384 float, Sensor_385 float, Sensor_386 float, Sensor_387 float, Sensor_388 float, Sensor_389 float, Sensor_390 float, Sensor_391 float, Sensor_392 float, Sensor_393 float, Sensor_394 float, Sensor_395 float, Sensor_396 float, Sensor_397 float, Sensor_398 float, Sensor_399 float, Sensor_400 float, Sensor_401 float, Sensor_402 float, Sensor_403 float, Sensor_404 float, Sensor_405 float, Sensor_406 float, Sensor_407 float, Sensor_408 float, Sensor_409 float, Sensor_410 float, Sensor_411 float, Sensor_412 float, Sensor_413 float, Sensor_414 float, Sensor_415 float, Sensor_416 float, Sensor_417 float, Sensor_418 float, Sensor_419 float, Sensor_420 float, Sensor_421 float, Sensor_422 float, Sensor_423 float, Sensor_424 float, Sensor_425 float, Sensor_426 float, Sensor_427 float, Sensor_428 float, Sensor_429 float, Sensor_430 float, Sensor_431 float, Sensor_432 float, Sensor_433 float, Sensor_434 float, Sensor_435 float, Sensor_436 float, Sensor_437 float, Sensor_438 float, Sensor_439 float, Sensor_440 float, Sensor_441 float, Sensor_442 float, Sensor_443 float, Sensor_444 float, Sensor_445 float, Sensor_446 float, Sensor_447 float, Sensor_448 float, Sensor_449 float, Sensor_450 float, Sensor_451 float, Sensor_452 float, Sensor_453 float, Sensor_454 float, Sensor_455 float, Sensor_456 float, Sensor_457 float, Sensor_458 float, Sensor_459 float, Sensor_460 float, Sensor_461 float, Sensor_462 float, Sensor_463 float, Sensor_464 float, Sensor_465 float, Sensor_466 float, Sensor_467 float, Sensor_468 float, Sensor_469 float, Sensor_470 float, Sensor_471 float, Sensor_472 float, Sensor_473 float, Sensor_474 float, Sensor_475 float, Sensor_476 float, Sensor_477 float, Sensor_478 float, Sensor_479 float, Sensor_480 float, Sensor_481 float, Sensor_482 float, Sensor_483 float, Sensor_484 float, Sensor_485 float, Sensor_486 float, Sensor_487 float, Sensor_488 float, Sensor_489 float, Sensor_490 float, Sensor_491 float, Sensor_492 float, Sensor_493 float, Sensor_494 float, Sensor_495 float, Sensor_496 float, Sensor_497 float, Sensor_498 float, Sensor_499 float, Sensor_500 float, Sensor_501 float, Sensor_502 float, Sensor_503 float, Sensor_504 float, Sensor_505 float, Sensor_506 float, Sensor_507 float, Sensor_508 float, Sensor_509 float, Sensor_510 float, Sensor_511 float, Sensor_512 float, Sensor_513 float, Sensor_514 float, Sensor_515 float, Sensor_516 float, Sensor_517 float, Sensor_518 float, Sensor_519 float, Sensor_520 float, Sensor_521 float, Sensor_522 float, Sensor_523 float, Sensor_524 float, Sensor_525 float, Sensor_526 float, Sensor_527 float, Sensor_528 float, Sensor_529 float, Sensor_530 float, Sensor_531 float, Sensor_532 float, Sensor_533 float, Sensor_534 float, Sensor_535 float, Sensor_536 float, Sensor_537 float, Sensor_538 float, Sensor_539 float, Sensor_540 float, Sensor_541 float, Sensor_542 float, Sensor_543 float, Sensor_544 float, Sensor_545 float, Sensor_546 float, Sensor_547 float, Sensor_548 float, Sensor_549 float, Sensor_550 float, Sensor_551 float, Sensor_552 float, Sensor_553 float, Sensor_554 float, Sensor_555 float, Sensor_556 float, Sensor_557 float, Sensor_558 float, Sensor_559 float, Sensor_560 float, Sensor_561 float, Sensor_562 float, Sensor_563 float, Sensor_564 float, Sensor_565 float, Sensor_566 float, Sensor_567 float, Sensor_568 float, Sensor_569 float, Sensor_570 float, Sensor_571 float, Sensor_572 float, Sensor_573 float, Sensor_574 float, Sensor_575 float, Sensor_576 float, Sensor_577 float, Sensor_578 float, Sensor_579 float, Sensor_580 float, Sensor_581 float, Sensor_582 float, Sensor_583 float, Sensor_584 float, Sensor_585 float, Sensor_586 float, Sensor_587 float, Sensor_588 float, Sensor_589 float, Sensor_590 float,target int)"
        cursor = db.cursor() #create a cursor to execute queries
        cursor.execute(query)
        return f"Table Created!! named as {table_name}"
    def get_data_from_database(self,db,database,table_name):
        query = f"select * from {database}.{table_name}"
        result_df=pd.read_sql(query,db)
        return result_df


